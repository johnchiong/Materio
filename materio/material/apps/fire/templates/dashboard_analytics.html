{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Dashboard - Analytics{% endblock title %}

{% block vendor_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/apex-charts/apex-charts.css' %}" />
{% endblock vendor_css %}

{% block vendor_js %}
{{ block.super }}
<script src="{% static 'vendor/libs/apex-charts/apexcharts.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock vendor_js %}

{% block page_js %}
{{ block.super }}
<script src="{% static 'js/dashboards-analytics.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    function loadChartData() {
      // === PIE ===
      fetch("/chart/pie/")
        .then((res) => res.json())
        .then((data) => {
          const pieCtx = document.getElementById("pieChart").getContext("2d");
          new Chart(pieCtx, {
            type: "pie",
            data: {
              labels: Object.keys(data),
              datasets: [{
                data: Object.values(data),
                backgroundColor: ["#1d7af3", "#f3545d", "#fdaf4b"]
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: "bottom",
                }
              }
            }
          });
        });

      // === LINE ===
      fetch("/chart/line/")
        .then((res) => res.json())
        .then((data) => {
          const lineCtx = document.getElementById("lineChart").getContext("2d");
          new Chart(lineCtx, {
            type: "line",
            data: {
              labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
              datasets: [{
                label: "Incidents",
                data: Object.values(data),
                borderColor: "#1d7af3",
                backgroundColor: "transparent",
                tension: 0.3,
                pointRadius: 4
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: "bottom",
                }
              }
            }
          });
        });

      // === MULTI-LINE ===
      fetch("/chart/multiline/")
        .then((res) => res.json())
        .then((data) => {
          const keys = Object.keys(data);
          const datasets = keys.map((country, i) => {
            const months = Object.keys(data[country]).sort((a, b) => parseInt(a) - parseInt(b));
            const color = ["#1fd43f", "#59405d", "#e26a2c"][i];
            return {
              label: country,
              data: months.map((m) => data[country][m]),
              borderColor: color,
              backgroundColor: "transparent",
              pointRadius: 3
            };
          });
          const ctx = document.getElementById("multipleLineChart").getContext("2d");
          new Chart(ctx, {
            type: "line",
            data: {
              labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
              datasets: datasets
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: "bottom",
                }
              }
            }
          });
        });

      // === MULTI-BAR ===
      fetch("/chart/multibar/")
        .then((res) => res.json())
        .then((data) => {
          const keys = Object.keys(data);
          const colors = ["#595d5d", "#f4a84b", "#1174d7"];
          const datasets = keys.map((severity, i) => {
            const months = Object.keys(data[severity]).sort((a, b) => parseInt(a) - parseInt(b));
            return {
              label: severity,
              data: months.map((m) => data[severity][m]),
              backgroundColor: colors[i],
              borderColor: colors[i]
            };
          });
          const ctx = document.getElementById("multipleBarChart").getContext("2d");
          new Chart(ctx, {
            type: "bar",
            data: {
              labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
              datasets: datasets
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: "bottom"
                }
              },
              scales: {
                x: {
                  stacked: true
                },
                y: {
                  stacked: true
                }
              }
            }
          });
        });
    }
    document.addEventListener("DOMContentLoaded", loadChartData);
</script>
{% endblock page_js %}

{% block content %}
<div class="row gy-6">
  <!-- Congratulations card -->
  
  <!--/ Congratulations card -->

  <!-- Transactions -->
  
  <!--/ Transactions -->

  <!-- Weekly Overview Chart -->
  
  <!--/ Weekly Overview Chart -->

  <!-- Total Earnings -->
  
  <!--/ Total Earnings -->

  <!-- Four Cards -->
 
      <!--/ Total Profit line chart -->
      <!-- Total Profit Weekly Project -->
      
      <!--/ Total Profit Weekly Project -->
      <!-- New Yearly Project -->
      
      <!--/ New Yearly Project -->
      <!-- Sessions chart -->
     
      <!--/ Sessions chart -->
    
  <!--/ Total Earning -->

  <!-- Sales by Countries -->
  
  <!--/ Sales by Countries -->

  <!-- Deposit / Withdraw -->
  
  <!-- Deposit / Withdraw -->

  <!-- Data Tables -->
  
  <!--/ Data Tables -->

  <!-- Chart.js Custom Charts -->
 <div class="row gy-3 mt-2">
  <div class="col-4">
    <div class="card">
      <div class="card-header"><h6 class="mb-0">Fire Incident Pie Ratio</h6></div>
      <div class="card-body">
        <canvas id="pieChart" height="350" style="width:100%;max-width:100%"></canvas>
      </div>
    </div>
  </div>
  <div class="col-5">
    <div class="card">
      <div class="card-header"><h6 class="mb-0">Incident Timeline</h6></div>
      <div class="card-body">
        <canvas id="lineChart" height="350" style="width:100%;max-width:100%"></canvas>
      </div>
    </div>
  </div>
  <div class="col-5">
    <div class="card">
      <div class="card-header"><h6 class="mb-0">Incident per Country</h6></div>
      <div class="card-body">
        <canvas id="multipleLineChart" height="350" style="width:100%;max-width:100%"></canvas>
      </div>
    </div>
  </div>
  <div class="col-5">
    <div class="card">
      <div class="card-header"><h6 class="mb-0">Incident Bar Count</h6></div>
      <div class="card-body">
        <canvas id="multipleBarChart" height="350" style="width:100%;max-width:100%"></canvas>
      </div>
    </div>
  </div>
</div>
  <!--/ Chart.js Custom Charts -->
</div>
{% endblock %}
